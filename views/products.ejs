<!DOCTYPE html>

<html lang="en">



<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Products</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>

    :root {

      --primary: #6c5ce7;

      --secondary: #00cec9;

      --accent: #fd79a8;

      --dark: #2d3436;

      --light: #f5f6fa;

    }



    * {

      margin: 0;

      padding: 0;

      box-sizing: border-box;

    }



    body {

      font-family: 'Poppins', sans-serif;

      background: linear-gradient(135deg, var(--primary), var(--secondary));

      min-height: 100vh;

      padding: 2rem;

      color: var(--dark);

    }



    h1 {

      text-align: center;

      margin-bottom: 2rem;

      color: white;

      font-size: 2.5rem;

      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);

      position: relative;

    }



    h1::after {

      content: '';

      display: block;

      width: 80px;

      height: 4px;

      background: linear-gradient(to right, var(--accent), var(--secondary));

      margin: 0.5rem auto 0;

      border-radius: 2px;

    }



    .search-container {

      max-width: 600px;

      margin: 0 auto 2rem;

      position: relative;

    }



    .search-bar {

      width: 100%;

      padding: 12px 20px;

      padding-right: 50px;

      border: none;

      border-radius: 30px;

      font-size: 1rem;

      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);

      transition: all 0.3s ease;

      background: rgba(255, 255, 255, 0.95);

    }



    .search-bar:focus {

      outline: none;

      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);

    }



    .search-button {

      position: absolute;

      right: 10px;

      top: 50%;

      transform: translateY(-50%);

      background: linear-gradient(to right, var(--accent), var(--secondary));

      border: none;

      color: white;

      padding: 8px 15px;

      border-radius: 20px;

      cursor: pointer;

      transition: all 0.3s ease;

    }



    .search-button:hover {

      transform: translateY(-50%) scale(1.05);

    }



    .product-list {

      display: grid;

      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));

      gap: 1.5rem;

      max-width: 1200px;

      margin: 0 auto;

    }



    .product-card {

      background: rgba(255, 255, 255, 0.95);

      border-radius: 12px;

      padding: 1.5rem;

      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);

      backdrop-filter: blur(5px);

      border: 1px solid rgba(255, 255, 255, 0.2);

      transition: all 0.3s ease;

      text-align: center;

      display: flex;

      flex-direction: column;

      justify-content: space-between;

      height: 385px;

    }



    .product-card:hover {

      transform: translateY(-5px);

      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);

    }



    .product-card img {

      width: 100%;

      height: 220px;

      object-fit: contain;

      border-radius: 8px;

      margin-bottom: 1rem;

      background-color: #f1f1f1;

      padding: 8px;

      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);

    }



    .product-name {

      font-weight: 600;

      margin-bottom: 0.5rem;

      color: var(--dark);

      font-size: 1.1rem;

      white-space: nowrap;

      overflow: hidden;

      text-overflow: ellipsis;

    }



    .product-price {

      color: var(--primary);

      font-weight: 700;

      font-size: 1.2rem;

    }



    .no-products {

      text-align: center;

      color: white;

      font-size: 1.2rem;

      grid-column: 1/-1;

      padding: 2rem;

      background: rgba(255, 255, 255, 0.2);

      border-radius: 12px;

      backdrop-filter: blur(5px);

    }



    .floating-bg {

      position: fixed;

      width: 300px;

      height: 300px;

      border-radius: 50%;

      background: rgba(253, 121, 168, 0.1);

      filter: blur(60px);

      z-index: -1;

    }



    .bg-1 { top: 20%; left: 10%; animation: float 8s ease-in-out infinite; }

    .bg-2 { bottom: 15%; right: 10%; animation: float 10s ease-in-out infinite reverse; }



    @keyframes float {

      0% { transform: translateY(0) rotate(0deg); }

      50% { transform: translateY(-20px) rotate(5deg); }

      100% { transform: translateY(0) rotate(0deg); }

    }

   

    /* ✅ Grouping container for desktop */

    .top-controls {

        display: block; /* Default for desktop */

    }



    .header-buttons {

      position: absolute;

      right: 56px;

      top: 200px;

      display: flex;

      gap: 10px;

    }



    .login-button, .profile-button, .dropdown-btn {

      padding: 0.6rem 1.2rem;

      font-size: 1rem;

      background-color: var(--primary);

      color: white;

      border: none;

      border-radius: 6px;

      cursor: pointer;

      transition: background 0.3s ease-in-out, transform 0.2s ease-in-out;

    }



    .login-button, .profile-button {

      background: linear-gradient(to right, var(--accent), var(--secondary));

      transform: scale(1.05);

    }



    .login-button h3, .profile-button h3, .dropdown-btn h3 {

      margin: 0;

      font-size: 1rem;

      font-weight: 600;

    }



    .dropdown { position: relative; }

    .dropdown-content {

      display: none;

      position: absolute;

      background-color: white;

      min-width: 160px;

      box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);

      z-index: 1;

      border-radius: 5px;

      top: 120%;

      right: 0;

    }

    .dropdown-content a { color: black; padding: 10px 14px; text-decoration: none; display: block; }

    .dropdown-content.show { display: block; }



    .delete-btn {

      margin-top: 10px;

      background-color: #ff4d4d;

      color: white;

      border: none;

      padding: 8px 16px;

      border-radius: 8px;

      font-weight: bold;

      cursor: pointer;

      transition: background-color 0.3s ease;

      width: 100%;

    }

    .delete-btn:hover { background-color: #e60000; }



    .pagination {

      display: flex;

      justify-content: center;

      align-items: center;

      flex-wrap: wrap;

      gap: 8px;

      margin-top: 30px;

    }

    .pagination a, .pagination .dots {

      padding: 8px 14px;

      border: 1px solid #ccc;

      border-radius: 6px;

      text-decoration: none;

      color: #333;

      font-weight: 500;

      background-color: #f9f9f9;

      transition: all 0.2s ease;

    }

    .pagination a:hover { background-color: #007bff; color: white; border-color: #007bff; }

    .pagination a.active { background-color: #007bff; color: white; border-color: #007bff; }



    /* Responsive styles for mobile */

    @media (max-width: 768px) {

      body { padding: 1rem; }

      h1 { font-size: 2rem; margin-bottom: 1.5rem; padding-top: 1rem; }

     

      /* ✅ Use flexbox to control order on mobile */

      .top-controls {

        display: flex;

        flex-direction: column;

      }

     

      .header-buttons {

        position: static;

        justify-content: center;

        margin-bottom: 1rem;

        flex-wrap: wrap;

        order: 1; /* ✅ Display first */

      }

      .search-container {

        margin-bottom: 1.5rem;

        order: 2; /* ✅ Display second */

      }

     

      .product-list { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; }

      .product-card { padding: 1rem; height: 300px; }

      .product-card img { height: 150px; margin-bottom: 0.5rem; }

      .product-name { font-size: 0.9rem; }

      .product-price { font-size: 1rem; }

      .delete-btn { padding: 6px 12px; font-size: 0.8rem; }

    }

  </style>

</head>



<body>

  <div class="floating-bg bg-1"></div>

  <div class="floating-bg bg-2"></div>



  <h3>Our Products</h3>

 

  <div class="top-controls">

    <div class="search-container">

      <form action="/products" method="GET" id="searchForm">

        <input type="text" name="search" class="search-bar" placeholder="Search products..." value="<%= searchQuery || '' %>" id="searchInput">

        <button type="submit" class="search-button">

          <i class="fas fa-search"></i>

        </button>

      </form>

    </div>



    <div class="header-buttons">

      <% if (!user) { %>

        <a href="/login">

          <button class="login-button"><h3>Login</h3></button>

        </a>

      <% } else { %>

        <% if (user.isAdmin) { %>

          <a href="/admin">

            <button class="profile-button"><h3><%= user.username.toUpperCase() %></h3></button>

          </a>

        <% } else { %>

          <a href="/user-profile">

            <button class="profile-button"><h3><%= user.username.toUpperCase() %></h3></button>

          </a>

        <% } %>

      <% } %>

      <div class="dropdown">

        <button class="dropdown-btn"><h3>Filter</h3></button>

        <div class="dropdown-content">

          <a href="/products?<%= searchQuery ? `search=${searchQuery}&` : '' %>sort=price">Sort by Price</a>

          <a href="/products?<%= searchQuery ? `search=${searchQuery}&` : '' %>sort=name">Sort by Name</a>

        </div>

      </div>

    </div>

  </div>



  <div class="product-list">

    <% if (products && products.length > 0) { %>

      <% products.forEach(product => { %>

        <div class="product-card">

          <div>

            <a href="/products/<%= product._id %>" style="text-decoration:none; color:inherit;">

              <img src="<%= product.url %>" alt="<%= product.name %>" />

              <div class="product-name" title="<%= product.name %>"><%= product.name %></div>

              <div class="product-price">₹<%= Number(product.price).toLocaleString('en-IN') %></div>

            </a>

          </div>

          <% if (typeof user !== "undefined" && user.isAdmin) { %>

            <button class="delete-btn" data-id="<%= product._id %>">Remove</button>

          <% } %>

        </div>

      <% }) %>

    <% } else { %>

      <p class="no-products">No products found. <i class="fas fa-box-open"></i></p>

    <% } %>

  </div>



  <div class="pagination">

    <% if (totalPages > 1) { %>

      <% if (currentPage > 1) { %>

        <a href="/products?page=<%= currentPage - 1 %><% if(locals.sort) { %>&sort=<%= locals.sort %><% } %><% if(locals.searchQuery) { %>&search=<%= locals.searchQuery %><% } %>">PREV</a>

      <% } %>

      <% for (let i = 1; i <= totalPages; i++) { %>

        <a href="/products?page=<%= i %><% if(locals.sort) { %>&sort=<%= locals.sort %><% } %><% if(locals.searchQuery) { %>&search=<%= locals.searchQuery %><% } %>" class="<%= currentPage === i ? 'active' : '' %>"><%= i %></a>

      <% } %>

      <% if (currentPage < totalPages) { %>

        <a href="/products?page=<%= currentPage + 1 %><% if(locals.sort) { %>&sort=<%= locals.sort %><% } %><% if(locals.searchQuery) { %>&search=<%= locals.searchQuery %><% } %>">NEXT</a>

      <% } %>

    <% } %>

  </div>



  <script>

    // All JavaScript remains unchanged

    document.addEventListener("DOMContentLoaded", () => {

      const dropdownBtn = document.querySelector(".dropdown-btn");

      const dropdownContent = document.querySelector(".dropdown-content");



      if (dropdownBtn) {

        dropdownBtn.addEventListener("click", (e) => {

          e.stopPropagation();

          dropdownContent.classList.toggle("show");

        });

      }



      document.addEventListener("click", (e) => {

        if (dropdownContent && !dropdownContent.contains(e.target) && !dropdownBtn.contains(e.target)) {

          dropdownContent.classList.remove("show");

        }

      });

    });



    document.querySelectorAll(".delete-btn").forEach(button => {

      button.addEventListener("click", async function (e) {

        e.preventDefault();

        e.stopPropagation();

        const productId = this.dataset.id;

        if (!confirm("Are you sure you want to delete this product?")) return;

        try {

          const response = await fetch(`/products/delete/${productId}`, { method: "DELETE" });

          if (response.ok) {

            window.location.reload();

          } else { alert("Failed to delete product."); }

        } catch (err) {

          console.error("Error:", err);

          alert("Something went wrong.");

        }

      });

    });

  </script>

</body>

</html> 
